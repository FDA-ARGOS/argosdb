{"ast":null,"code":"var _jsxFileName = \"/Users/rykahsay/projects/argosdb_dsbrowser/app/src/components/search_results.jsx\";\nimport React, { Component } from \"react\";\nimport Searchbox from \"./search_box\";\nimport Resultfilter from \"./result_filter\";\nimport { filterObjectList, rndrSearchResults } from './util';\nimport Paginator from \"./paginator\";\nimport * as LocalConfig from \"./local_config\";\nimport Loadingicon from \"./loading_icon\";\nimport Alertdialog from './dialogbox';\nimport $ from \"jquery\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass SearchResults extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      filterlist: [],\n      pageIdx: 1,\n      pageBatchSize: 5,\n      pageStartIdx: 1,\n      pageEndIdx: 5,\n      dialog: {\n        status: false,\n        msg: \"\"\n      }\n    };\n\n    this.handleDialogClose = () => {\n      var tmpState = this.state;\n      tmpState.dialog.status = false;\n      this.setState(tmpState);\n    };\n\n    this.handleKeyPress = e => {\n      if (e.key === \"Enter\") {\n        e.preventDefault();\n        this.handleSearch();\n      }\n    };\n\n    this.handleSearch = () => {\n      var queryValue = $(\"#query\").val();\n      queryValue = queryValue === undefined ? \"\" : queryValue;\n      var reqObj = {\n        query: queryValue\n      };\n      this.handleFilterReset();\n      const requestOptions = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(reqObj)\n      };\n      const svcUrl = LocalConfig.apiHash.dataset_search;\n      fetch(svcUrl, requestOptions).then(res => res.json()).then(result => {\n        var tmpState = this.state;\n        tmpState.response = result;\n        tmpState.isLoaded = true;\n\n        if (tmpState.response.status === 0) {\n          tmpState.dialog.status = true;\n          tmpState.dialog.msg = tmpState.response.error;\n        }\n\n        this.setState(tmpState); //console.log(\"Request:\",svcUrl);\n\n        console.log(\"Ajax response:\", result);\n      }, // Note: it's important to handle errors here\n      // instead of a catch() block so that we don't swallow\n      // exceptions from actual bugs in components.\n      error => {\n        this.setState({\n          isLoaded: true,\n          error\n        });\n      });\n    };\n\n    this.handleFilterReset = () => {\n      $('input[name=\"filtervalue\"]:checkbox:checked').prop(\"checked\", false);\n      this.setState({\n        filterlist: []\n      });\n    };\n\n    this.handleFilterApply = () => {\n      $(\"#filtercn\").toggle();\n      var tmpList = $('input[name=\"filtervalue\"]:checkbox:checked').map(function () {\n        return $(this).val();\n      }).get(); // <----\n\n      this.setState({\n        filterlist: tmpList\n      });\n    };\n\n    this.handleFilterIcon = () => {\n      $(\"#filtercn\").toggle();\n    };\n\n    this.handlePaginatorClick = e => {\n      if (e.target.id.indexOf(\"_disabled\") !== -1) {\n        return;\n      }\n\n      var pageIdx = parseInt(e.target.id.split(\"_\")[2]);\n      var tmpState = this.state;\n\n      if (e.target.id.indexOf(\"_next_\") !== -1) {\n        tmpState.pageStartIdx = tmpState.pageEndIdx + 1;\n        tmpState.pageEndIdx += tmpState.pageBatchSize;\n        pageIdx = tmpState.pageStartIdx;\n      } else if (e.target.id.indexOf(\"_prev_\") !== -1) {\n        tmpState.pageStartIdx -= tmpState.pageBatchSize;\n        tmpState.pageEndIdx = tmpState.pageStartIdx + tmpState.pageBatchSize - 1;\n        pageIdx = tmpState.pageStartIdx;\n      }\n\n      tmpState.pageIdx = pageIdx;\n      this.setState(tmpState);\n    };\n  }\n\n  componentDidMount() {\n    this.handleSearch();\n  }\n\n  render() {\n    if (!(\"response\" in this.state)) {\n      return /*#__PURE__*/_jsxDEV(Loadingicon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 14\n      }, this);\n    }\n\n    const objList = this.state.response.recordlist !== undefined ? this.state.response.recordlist : []; //var filObj = filterObjectList(objList, []);\n\n    var filObj = filterObjectList(objList, this.state.filterlist);\n    var filterInfo = filObj.filterinfo;\n    var passedObjList = filObj.passedobjlist;\n    var passedCount = passedObjList.length;\n    var batchSize = 20;\n    var pageCount = parseInt(passedObjList.length / batchSize) + 1;\n    pageCount = objList.length > 0 ? pageCount : 0;\n    var startIdx = batchSize * (parseInt(this.state.pageIdx) - 1) + 1;\n    var endIdx = startIdx + batchSize;\n    endIdx = endIdx > passedCount ? passedCount : endIdx;\n    var filterHideFlag = objList.length > 0 ? \"block\" : \"none\";\n    var tmpList = [];\n\n    for (var i in this.state.filterlist) {\n      var h = \"<b>\" + this.state.filterlist[i].split(\"|\")[1] + \"</b>\";\n      tmpList.push(h);\n    }\n\n    var resultSummary = \"<b>\" + passedObjList.length + \"</b> results found\";\n    resultSummary += tmpList.length > 0 ? \", after filters: '\" + tmpList.join(\"', '\") + \"'.\" : \".\"; //return (<div>{this.state.pageStartIdx} {this.state.pageEndIdx}</div>);\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Alertdialog, {\n        dialog: this.state.dialog,\n        onClose: this.handleDialogClose\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pagecn\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"leftblock\",\n          style: {\n            width: \"100%\",\n            margin: \"20px 0px 0px 0px\"\n          },\n          children: /*#__PURE__*/_jsxDEV(Searchbox, {\n            label: \"Search by: BCOID, dataset file name, title, description or  categories\",\n            onSearch: this.handleSearch,\n            onKeyPress: this.handleKeyPress\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"leftblock\",\n          style: {\n            width: \"100%\",\n            margin: \"5px 0px 0px 0px\",\n            display: filterHideFlag\n          },\n          children: /*#__PURE__*/_jsxDEV(Resultfilter, {\n            filterinfo: filterInfo,\n            resultcount: objList.length,\n            resultSummary: resultSummary,\n            handleSearchIcon: this.handleSearchIcon,\n            handleFilterIcon: this.handleFilterIcon,\n            handleFilterApply: this.handleFilterApply,\n            handleFilterReset: this.handleFilterReset\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"leftblock\",\n          style: {\n            width: \"100%\",\n            margin: \"60px 0px 0px 0px\",\n            borderBottom: \"1px solid #ccc\"\n          },\n          children: /*#__PURE__*/_jsxDEV(Paginator, {\n            paginatorId: \"top\",\n            pageCount: pageCount,\n            pageStartIdx: this.state.pageStartIdx,\n            pageEndIdx: this.state.pageEndIdx,\n            onClick: this.handlePaginatorClick\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"leftblock\",\n          style: {\n            margin: \"20px 0px 0px 0px\"\n          },\n          children: rndrSearchResults(passedObjList, startIdx, endIdx)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"leftblock\",\n          style: {\n            width: \"100%\",\n            margin: \"0px 0px 0px 0px\",\n            padding: \"5px 0px 0px 0px\",\n            borderTop: \"1px solid #ccc\"\n          },\n          children: /*#__PURE__*/_jsxDEV(Paginator, {\n            paginatorId: \"bottom\",\n            pageCount: pageCount,\n            pageStartIdx: this.state.pageStartIdx,\n            pageEndIdx: this.state.pageEndIdx,\n            onClick: this.handlePaginatorClick\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default SearchResults;","map":{"version":3,"sources":["/Users/rykahsay/projects/argosdb_dsbrowser/app/src/components/search_results.jsx"],"names":["React","Component","Searchbox","Resultfilter","filterObjectList","rndrSearchResults","Paginator","LocalConfig","Loadingicon","Alertdialog","$","SearchResults","state","filterlist","pageIdx","pageBatchSize","pageStartIdx","pageEndIdx","dialog","status","msg","handleDialogClose","tmpState","setState","handleKeyPress","e","key","preventDefault","handleSearch","queryValue","val","undefined","reqObj","query","handleFilterReset","requestOptions","method","headers","body","JSON","stringify","svcUrl","apiHash","dataset_search","fetch","then","res","json","result","response","isLoaded","error","console","log","prop","handleFilterApply","toggle","tmpList","map","get","handleFilterIcon","handlePaginatorClick","target","id","indexOf","parseInt","split","componentDidMount","render","objList","recordlist","filObj","filterInfo","filterinfo","passedObjList","passedobjlist","passedCount","length","batchSize","pageCount","startIdx","endIdx","filterHideFlag","i","h","push","resultSummary","join","width","margin","display","handleSearchIcon","borderBottom","padding","borderTop"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Searchbox from \"./search_box\";\nimport Resultfilter from \"./result_filter\";\nimport { filterObjectList, rndrSearchResults} from './util';\nimport Paginator from \"./paginator\";\nimport * as LocalConfig from \"./local_config\";\nimport Loadingicon from \"./loading_icon\";\nimport Alertdialog from './dialogbox';\nimport $ from \"jquery\";\n\n\nclass SearchResults extends Component {  \n  \n  state = {\n    filterlist: [],\n    pageIdx:1,\n    pageBatchSize:5,\n    pageStartIdx:1,\n    pageEndIdx:5,\n    dialog:{\n      status:false, \n      msg:\"\"\n    }\n  };\n\n  componentDidMount() {\n    this.handleSearch();\n  }\n\n\n  handleDialogClose = () => {\n    var tmpState = this.state;\n    tmpState.dialog.status = false;\n    this.setState(tmpState);\n  }\n\n  \n  handleKeyPress = (e) => {\n    if(e.key === \"Enter\"){\n      e.preventDefault();\n      this.handleSearch();\n    }\n  }\n \n\n   handleSearch = () => {\n    var queryValue = $(\"#query\").val();\n    queryValue = (queryValue === undefined ? \"\" : queryValue);\n    var reqObj = {query:queryValue};\n\n    this.handleFilterReset();\n\n    const requestOptions = { \n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(reqObj)\n    };\n    const svcUrl = LocalConfig.apiHash.dataset_search;\n\n    fetch(svcUrl, requestOptions)\n      .then((res) => res.json())\n      .then(\n        (result) => {\n          var tmpState = this.state;\n          tmpState.response = result;\n          tmpState.isLoaded = true;          \n          if (tmpState.response.status === 0){\n            tmpState.dialog.status = true;\n            tmpState.dialog.msg = tmpState.response.error;\n          }\n          this.setState(tmpState);\n          //console.log(\"Request:\",svcUrl);\n          console.log(\"Ajax response:\", result);\n        },\n        // Note: it's important to handle errors here\n        // instead of a catch() block so that we don't swallow\n        // exceptions from actual bugs in components.\n        (error) => {\n          this.setState({\n            isLoaded: true,\n            error,\n          });\n        }\n      );\n  }\n\n\n  handleFilterReset = () => {\n    $('input[name=\"filtervalue\"]:checkbox:checked').prop(\"checked\", false);\n    this.setState({ filterlist: [] });\n  };\n\n  handleFilterApply = () => {\n    $(\"#filtercn\").toggle();\n    var tmpList = $('input[name=\"filtervalue\"]:checkbox:checked')\n      .map(function () {\n        return $(this).val();\n      })\n      .get(); // <----\n    \n    this.setState({ filterlist: tmpList });\n    \n  };\n\n  handleFilterIcon = () => {\n    $(\"#filtercn\").toggle();\n  };\n\n  \n\n\n\n  handlePaginatorClick = (e) => {\n    if(e.target.id.indexOf(\"_disabled\") !== -1){\n      return;\n    }\n    var pageIdx = parseInt(e.target.id.split(\"_\")[2]);\n    var tmpState = this.state;\n    if(e.target.id.indexOf(\"_next_\") !== -1){\n      tmpState.pageStartIdx = tmpState.pageEndIdx + 1;\n      tmpState.pageEndIdx += tmpState.pageBatchSize;\n      pageIdx = tmpState.pageStartIdx;\n    }\n    else if(e.target.id.indexOf(\"_prev_\") !== -1){\n      tmpState.pageStartIdx -= tmpState.pageBatchSize;\n      tmpState.pageEndIdx = tmpState.pageStartIdx + tmpState.pageBatchSize - 1;\n      pageIdx = tmpState.pageStartIdx;\n    }\n    tmpState.pageIdx = pageIdx;\n    this.setState(tmpState);\n\n  }\n\n  render() {\n  \n    if (!(\"response\" in this.state)){\n      return <Loadingicon/>\n    }\n\n    const objList = (this.state.response.recordlist !== undefined ? this.state.response.recordlist : []);\n    \n    //var filObj = filterObjectList(objList, []);\n    var filObj = filterObjectList(objList, this.state.filterlist);\n    var filterInfo = filObj.filterinfo;\n    var passedObjList = filObj.passedobjlist;\n    var passedCount = passedObjList.length;\n\n    var batchSize = 20;\n    var pageCount = parseInt(passedObjList.length/batchSize) + 1;\n    pageCount = (objList.length > 0 ? pageCount : 0);\n\n\n    var startIdx = batchSize * (parseInt(this.state.pageIdx) - 1) + 1;\n    var endIdx = startIdx + batchSize;\n    endIdx = (endIdx > passedCount ? passedCount : endIdx);\n\n    var filterHideFlag = (objList.length > 0 ? \"block\" : \"none\");\n\n    var tmpList = [];\n    for (var i in this.state.filterlist){\n        var h = \"<b>\" + this.state.filterlist[i].split(\"|\")[1] + \"</b>\";\n        tmpList.push(h);\n    }\n    var resultSummary = \"<b>\" + passedObjList.length + \"</b> results found\";\n    resultSummary += (tmpList.length > 0 ? \", after filters: '\" + tmpList.join(\"', '\") + \"'.\" : \".\"); \n\n   //return (<div>{this.state.pageStartIdx} {this.state.pageEndIdx}</div>);\n\n    return (\n      <div>\n      <Alertdialog dialog={this.state.dialog} onClose={this.handleDialogClose}/>\n\n      <div className=\"pagecn\">\n        \n        <div className=\"leftblock\" style={{width:\"100%\", margin:\"20px 0px 0px 0px\"}}>\n          <Searchbox label={\"Search by: BCOID, dataset file name, title, description or  categories\"} onSearch={this.handleSearch} onKeyPress={this.handleKeyPress}/>\n        </div>\n        <div className=\"leftblock\" style={{width:\"100%\", margin:\"5px 0px 0px 0px\",display:filterHideFlag}}>\n          <Resultfilter\n            filterinfo={filterInfo}\n            resultcount={objList.length}\n            resultSummary={resultSummary}\n            handleSearchIcon={this.handleSearchIcon}\n            handleFilterIcon={this.handleFilterIcon}\n            handleFilterApply={this.handleFilterApply}\n            handleFilterReset={this.handleFilterReset}\n          />\n        </div>\n      \n        <div className=\"leftblock\" \n          style={{width:\"100%\", margin:\"60px 0px 0px 0px\",\n          borderBottom:\"1px solid #ccc\"}}>\n          <Paginator \n            paginatorId={\"top\"}\n            pageCount={pageCount}\n            pageStartIdx={this.state.pageStartIdx}\n            pageEndIdx={this.state.pageEndIdx}\n            onClick={this.handlePaginatorClick}\n          />\n        </div>\n\n        <div className=\"leftblock\" \n          style={{margin:\"20px 0px 0px 0px\"}}>\n          {rndrSearchResults(passedObjList, startIdx, endIdx)}\n        </div>\n\n        <div className=\"leftblock\" \n          style={{width:\"100%\", \n          margin:\"0px 0px 0px 0px\",\n          padding:\"5px 0px 0px 0px\",\n          borderTop:\"1px solid #ccc\"}}>\n          <Paginator \n            paginatorId={\"bottom\"}\n            pageCount={pageCount}\n            pageStartIdx={this.state.pageStartIdx}\n            pageEndIdx={this.state.pageEndIdx}\n            onClick={this.handlePaginatorClick}\n          />\n        </div>\n\n      </div>\n      \n      </div>\n    );\n  }\n}\n\nexport default SearchResults;\n"]},"metadata":{},"sourceType":"module"}